# Lab3 实验总结

实验目标
- 理解并实现查询解析、语义分析、查询执行与结果输出的完整流程。验证 SELECT/INSERT/UPDATE/DELETE 及事务/辅助命令的基本行为。

已实现内容（简要）
- 解析与语义分析：实现了 `analyze::do_analyze`，可以将解析树转换为内部 Query 结构，完成列名解析、表存在性与类型检查、WHERE 条件的类型校验与列名消歧。
- 查询执行：实现了执行管理器 `QlManager`，支持 DDL/DML/查询/命令工具（help、show/desc、事务控制）。已有多种执行器（顺序扫描、索引扫描、投影、嵌套循环连接、插入、删除、更新等）的骨架与调用。查询结果通过内存缓冲输出并追加写入 `output.txt`，同时在客户端返回文本化表格。
- IO 与打印：实现了 `RecordPrinter` 用于在返回缓冲区中格式化表头、记录和统计信息；查询结果也追加写入 `output.txt` 以便实验验证。

关键实现点
- 列名推断：当 SELECT 中未指定表名前缀时，分析器会在查询涉及的所有表列中查找并进行二义性检测。
- 类型一致性校验：WHERE / SET /比较操作会进行类型比对，遇到不匹配会抛出异常（IncompatibleTypeError）。
- 执行器接口：统一的 `AbstractExecutor` 接口（beginTuple/is_end/nextTuple/Next/cols）让不同执行器可以构成执行树并被 `QlManager::select_from` 遍历输出。

遇到的问题与建议（简短）
- 多表查询的列歧义与同名列处理：当前的实现依赖分析阶段的消歧策略，复杂查询（如多表同名列且未限定）仍需在使用时小心避免歧义。
- 性能与索引使用：当前执行器实现以教学为主，优化策略（代价估算、索引选择）尚未完备，后续可实现简单的选择性估算以优先使用索引扫描。

运行与验证
- 交互式客户端可执行支持的 SQL 命令，SELECT 的输出会追加到工程根目录下的 `output.txt`，同时返回格式化文本到客户端缓冲区用于展示和测试断言。

总结
- Lab3 覆盖了从解析到执行的端到端流程，代码结构清晰，分析器与执行器的分工明确。当前实现满足实验要求的功能性目标；后续可在执行计划选择与性能优化、更多容错与更丰富的 SQL 支持上继续扩展。

（文件位置：`lab3-scripts/lab3_summary.md`）
